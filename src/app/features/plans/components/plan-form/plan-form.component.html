<div class="p-6 w-full max-w-3xl mx-auto flex flex-col space-y-6">
  <span
    class="text-center text-4xl md:text-6xl font-semibold text-gray-800 mb-8"
  >
    {{ title }} üìù
  </span>

  @if (loading$ | async) {
    <app-loader></app-loader>
  } @else {
    <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
      <form [formGroup]="planForm" class="space-y-6">
        <app-title [title]="'Informaci√≥n general'"></app-title>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <app-input
            [control]="getControl('name')"
            label="Nombre del plan"
            type="text"
            errorKey="name"
          ></app-input>

          <app-input
            [control]="getControl('days')"
            label="D√≠as del plan"
            type="number"
            errorKey="days"
            placeholder="N√∫mero de d√≠as (1-7)"
          ></app-input>

          <app-input
            [control]="getControl('minAge')"
            label="Edad m√≠nima"
            type="number"
            errorKey="minAge"
          ></app-input>

          <app-input
            [control]="getControl('maxAge')"
            label="Edad m√°xima"
            type="number"
            errorKey="maxAge"
          ></app-input>

          <mat-form-field appearance="outline" class="w-full rounded-md">
            <mat-label class="text-gray-700">Tipo</mat-label>
            <mat-select formControlName="type" class="bg-gray-50">
              <mat-option *ngFor="let type of planTypes" [value]="type.value">
                {{ type.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full rounded-md">
            <mat-label class="text-gray-700">Objetivo</mat-label>
            <mat-select formControlName="goal" class="bg-gray-50">
              <mat-option *ngFor="let goal of planGoals" [value]="goal.value">
                {{ goal.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          @if (isInjuryRecoveryGoal()) {
            <mat-form-field appearance="outline" class="w-full rounded-md">
              <mat-label class="text-gray-700">Tipo de lesi√≥n</mat-label>
              <mat-select formControlName="injuryType">
                <mat-option
                  *ngFor="let injury of injuryTypes"
                  [value]="injury.value"
                >
                  {{ injury.label }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          }

          <mat-form-field appearance="outline" class="w-full rounded-md">
            <mat-label class="text-gray-700">Nivel de Experiencia</mat-label>
            <mat-select formControlName="experienceLevel" class="bg-gray-50">
              <mat-option
                *ngFor="let level of experienceLevels"
                [value]="level.value"
              >
                {{ level.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <div class="md:col-span-2 flex mt-[-2rem] items-center">
            <mat-checkbox
              formControlName="includesCoach"
              class="text-blue-700 font-medium"
              >Incluye entrenador</mat-checkbox
            >
          </div>
        </div>

        <div class="w-full pt-4 border-t border-gray-200">
          <p class="text-md text-gray-600 mb-2 font-medium">
            Rutina por defecto
          </p>
          <app-autocomplete
            [control]="defaultRoutineControl"
            [selector]="selector"
            [action]="action"
            placeholder="Buscar Rutina"
            propertyToDisplay="name"
            (itemSelected)="onSelectedRoutine($event)"
            class="rounded-md"
          >
          </app-autocomplete>
        </div>
      </form>

      <div
        class="flex flex-col md:flex-row justify-end space-y-4 md:space-y-0 md:space-x-2 mt-8 pt-4 border-t border-gray-200"
      >
        <button
          appBtn
          class="btn-secondary w-full md:w-auto transition-all hover:bg-gray-200"
          (click)="goBack()"
        >
          Volver
        </button>
        <button
          appBtn
          color="primary"
          [loader]="(loading$ | async)!"
          [animate]="true"
          (click)="save()"
          type="button"
          [disabled]="planForm.invalid || (loading$ | async)"
          class="w-full md:w-auto transition-all hover:shadow-lg"
        >
          {{ btnTitle }}
        </button>
      </div>
    </div>
  }
</div>
